elasticsearch:
  image: library/elasticsearch:latest
  hostname: elasticsearch
  ports:
    - "9200:9200"
    - "9300"
  volumes:
    - /data

redis:
  image: redis
  hostname: redis
  ports:
    - "6379"

rabbitmq:
  image: raintank/rabbitmq
  hostname: rabbitmq
  ports:
    - "5672"
    - "15672:15672"

nsqd:
  image: nsqio/nsq:v0.3.6
  hostname: nsqd
  ports:
    - "4150:4150"
    - "4151:4151"
  command: "/bin/sh -c 'while true; do /nsqd -max-msg-size=10024768 -sync-every=1 --mem-queue-size=0 -e2e-processing-latency-percentile=0.90,0.99 -e2e-processing-latency-window-time=10s -statsd-address=statsdaemon:8125 -statsd-interval=10s; done'"
  links:
    - statsdaemon:statsdaemon

nsqadmin:
  image: nsqio/nsq:v0.3.6
  hostname: nsqadmin
  ports:
    - "4171:4171"
  command: "/nsqadmin --nsqd-http-address=nsqd:4151"
  links:
    - nsqd:nsqd

graphiteWatcher:
  image: raintank/graphite-watcher
  hostname: watcher
  links:
    - elasticsearch:elasticsearch
    - influxdb:influxdb
    - graphiteApi:graphite-api
  volumes:
    - ./logs:/var/log/raintank
    - ./raintank_code/raintank-metric:/go/src/github.com/raintank/raintank-metric

nsqMetricsTank:
  image: raintank/nsq_metrics_tank
  hostname: nmt
  ports:
    - "6063:6063"
  links:
    - nsqd:nsqd
    - statsdaemon:statsdaemon
    - influxdb:influxdb
    - cassandra:cassandra
  volumes:
    - ./logs:/var/log/raintank
    - ./raintank_code/raintank-metric:/go/src/github.com/raintank/raintank-metric

nsqMetricsToStdout:
  image: raintank/nsq_metrics_to_stdout
  hostname: nms
  links:
    - nsqd:nsqd
  volumes:
    - ./raintank_code/raintank-metric:/go/src/github.com/raintank/raintank-metric

nsqMetricsToElasticsearch:
  image: raintank/nsq_metrics_to_elasticsearch
  hostname: nme
  ports:
    - "6061:6060"
  links:
    - nsqd:nsqd
    - redis:redis
    - elasticsearch:elasticsearch
    - statsdaemon:statsdaemon
  volumes:
    - ./logs:/var/log/raintank
    - ./raintank_code/raintank-metric:/go/src/github.com/raintank/raintank-metric

nsqProbeEventsToElasticsearch:
  image: raintank/nsq_probe_events_to_elasticsearch
  hostname: npee
  ports:
    - "6062:6060"
  links:
    - nsqd:nsqd
    - elasticsearch:elasticsearch
    - statsdaemon:statsdaemon
  volumes:
    - ./logs:/var/log/raintank
    - ./raintank_code/raintank-metric:/go/src/github.com/raintank/raintank-metric

influxdb:
  image: raintank/influxdb
  hostname: influxdb
  ports:
    - "8086:8086"
    - "8083:8083"
    - "2003:2003"
  volumes:
    - /opt/influxdb/shared/data

cassandra:
  image: cassandra:2.1.9
  hostname: cassandra
  ports:
    - "9042"
    - "9160"
    - "8888"

mysql:
  image: mysql
  hostname: mysql
  ports:
    - "3306"
  environment:
    MYSQL_ROOT_PASSWORD: rootpass
    MYSQL_DATABASE: grafana
    MYSQL_USER: grafana
    MYSQL_PASSWORD: password
  volumes:
    - /var/lib/mysql

graphiteApi:
  image: raintank/graphite-api
  hostname: graphite
  ports:
    - "8888:8888"
  links:
    - elasticsearch:elasticsearch
    - statsdaemon:statsdaemon
    - influxdb:influxdb
    - cassandra:cassandra
    - nsqMetricsTank:nsqmetricstank
  environment:
    GRAPHITE_kairosdb_uri: http://kairosdb:8080
  volumes:
    - ./logs:/var/log/raintank

grafana:
  image: raintank/grafana-dev
  hostname: grafana
  ports:
    - "80:80"
    - "443:443"
  links:
    - rabbitmq:rabbitmq
    - graphiteApi:graphite-api
    - mysql:mysql
    - elasticsearch:elasticsearch
    - influxdb:influxdb
    - statsdaemon:statsdaemon
    - nsqd:nsqd
  volumes:
    - ./raintank_code/grafana:/go/src/github.com/raintank/grafana
    - ./logs:/var/log/raintank
    - ./grafana/conf:/etc/grafana/
    - /go/src/github.com/raintank/grafana/data

statsdaemon:
  image: raintank/statsdaemon
  hostname: statsdaemon
  ports:
    - "8126:8126"
  links:
    - influxdb:influxdb

benchmark:
  image: raintank/benchmark
  hostname: benchmark
  volumes:
    - ./results:/opt/raintank/raintank-tsdb-benchmark/results
